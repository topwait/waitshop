{extend name="public/layout" /}

{block name="body"}
<div class="container">
    <div class="layui-row layui-col-space15 wait-preview">
        <!-- 所有订单 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card">
                <div class="subject">
                    <div class="icons"><img src="__STATIC__/images/console/home-09.png" alt="none"></div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.totalPayOrderCount ?? 0}</div>
                        <div class="stat-heading">已付订单</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 今日订单 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card">
                <div class="subject">
                    <div class="icons">
                        <img src="__STATIC__/images/console/home-06.png" alt="none">
                    </div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.todayPayOrderCount ?? 0}</div>
                        <div class="stat-heading">今付订单</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 待发货 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card ">
                <div class="subject">
                    <div class="icons">
                        <img src="__STATIC__/images/console/home-05.png" alt="none">
                    </div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.waitDeliveryOrderCount ?? 0}</div>
                        <div class="stat-heading">待发货</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 待退款 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card">
                <div class="subject">
                    <div class="icons">
                        <img src="__STATIC__/images/console/home-07.png" alt="none">
                    </div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.refundOrderCount ?? 0}</div>
                        <div class="stat-heading">待退款</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 累计用户 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card">
                <div class="subject">
                    <div class="icons"><img src="__STATIC__/images/console/home-04.png" alt="none"></div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.totalUserCount ?? 0}</div>
                        <div class="stat-heading">累计用户</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 月增用户 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card">
                <div class="subject">
                    <div class="icons">
                        <img src="__STATIC__/images/console/home-08.png" alt="none">
                    </div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.monthUserCount ?? 0}</div>
                        <div class="stat-heading">月增用户</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 商品数量 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card ">
                <div class="subject">
                    <div class="icons">
                        <img src="__STATIC__/images/console/home-02.png" alt="none">
                    </div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.goodsCount ?? 0}</div>
                        <div class="stat-heading">商品数量</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 今日收益 -->
        <div class="layui-col-xs6 layui-col-md3">
            <div class="layui-card">
                <div class="subject">
                    <div class="icons">
                        <img src="__STATIC__/images/console/home-01.png" alt="none">
                    </div>
                    <div class="textarea">
                        <div class="stat-text">{$detail.todayProfit ?? 0}</div>
                        <div class="stat-heading">今日收益</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-row layui-col-space15">
        <!-- 【左侧侧区块】 -->
        <div class="layui-col-md8">
            <div class="layui-row layui-col-space15">
                <!-- 快捷方式 -->
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">快捷方式</div>
                        <div class="layui-card-body">
                            <div class="wait-shortcut">
                                <ul class="layui-row layui-col-space10 quick-event">
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/order.Order/lists.html">
                                            <i class="layui-icon layui-icon-console"></i>
                                            <cite>订单</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/order.AfterSale/lists.html">
                                            <i class="layui-icon layui-icon-chart"></i>
                                            <cite>售后</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/Diy/lists.html">
                                            <i class="layui-icon layui-icon-template-1"></i>
                                            <cite>装修</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/auth.Admin/lists.html">
                                            <i class="layui-icon layui-icon-chat"></i>
                                            <cite>权限</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/system.Crontab/lists.html">
                                            <i class="layui-icon layui-icon-find-fill"></i>
                                            <cite>任务</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/setting.Notice/lists.html">
                                            <i class="layui-icon layui-icon-survey"></i>
                                            <cite>通知</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/user.User/lists.html">
                                            <i class="layui-icon layui-icon-user"></i>
                                            <cite>用户</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/admin/setting.Basic/index.html">
                                            <i class="layui-icon layui-icon-set"></i>
                                            <cite>设置</cite>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 待办事项 -->
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">待办事项</div>
                        <div class="layui-card-body">
                            <div class="wait-backlog">
                                <ul class="layui-row layui-col-space10 quick-event">
                                    <li class="layui-col-xs6">
                                        <a lay-href="/admin/order.Order/lists.html">
                                            <h3>待发货订单</h3>
                                            <p><cite>{$detail.waitDeliveryOrderCount ?? 0}</cite></p>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs6">
                                        <a lay-href="/admin/order.Order/lists.html">
                                            <h3>待核销订单</h3>
                                            <p><cite>{$detail.waitWriteOffOrderCount ?? 0}</cite></p>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs6">
                                        <a lay-href="/admin/order.AfterSale/lists.html">
                                            <h3>待处理售后</h3>
                                            <p><cite>{$detail.refundOrderCount ?? 0}</cite></p>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs6">
                                        <a lay-href="/admin/goods.Comment/lists.html">
                                            <h3>待回复评论</h3>
                                            <p><cite>{$detail.stayReplyCommentCount ?? 0}</cite></p>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 数据概览 -->
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">数据概览</div>
                        <div class="layui-card-body">
                            <div class="layui-carousel wait-carousel wait-data-view" data-anim="fade"
                                 lay-filter="echarts">
                                <div carousel-item id="echarts">
                                    <div><i class="layui-icon layui-icon-loading1"></i></div>
                                    <div></div>
                                    <div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 【右侧区块】 -->
        <div class="layui-col-md4">
            <!-- 版本信息 -->
            <div class="layui-card">
                <div class="layui-card-header">版本信息</div>
                <div class="layui-card-body layui-text">
                    <table class="layui-table">
                        <colgroup>
                            <col width="100">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>当前版本</td>
                            <td>v1.00<a href="/" target="_blank" style="padding-left: 15px;">更新日志</a></td>
                        </tr>
                        <tr>
                            <td>基于框架</td>
                            <td>ThinkPHP6 + Layui</td>
                        </tr>
                        <tr>
                            <td>主要特色</td>
                            <td>零门槛 / 开源 / 清爽 / 极简</td>
                        </tr>
                        <tr>
                            <td>获取渠道</td>
                            <td style="padding-bottom: 0;">
                                <div class="layui-btn-container">
                                    <a href="https://gitee.com/wafts/WaitShop" target="_blank" class="layui-btn layui-btn-danger" style="height:30px; line-height:30px;">Gitee</a>
                                    <a href="http://www.waitshop.cn/" target="_blank" class="layui-btn" style="height:30px; line-height:30px;">官方网站</a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 热销商品 -->
            <div class="layui-card">
                <div class="layui-card-header">商品销量排行</div>
                <div class="layui-card-body wait-ranking">
                    <table class="layui-table" lay-skin="line" lay-size="sm">
                        <colgroup>
                            <col width="55">
                            <col>
                            <col width="55">
                        </colgroup>
                        <thead>
                            <tr>
                                <th>排名</th>
                                <th>商品</th>
                                <th style="text-align:center;">销量</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$detail.goodsRanking" id="vo" key="k"}
                            <tr>
                                <td><span class="tips">{$k+1}</span></td>
                                <td>
                                    <div class="goods">
                                        <img src="{$vo.image}" alt="img">
                                        <p class="wait-line-1">{$vo.name}</p>
                                    </div>
                                </td>
                                <td>
                                    <p class="wait-line-1" style="text-align:center;">{$vo.sales_volume}</p>
                                </td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>
{/block}

{block name="js"}
<script>
    //区块轮播切换
    layui.use(["element", "carousel"], function () {
        let $ = layui.$
            ,carousel = layui.carousel
            ,element = layui.element
            ,device = layui.device();

        $('.layui-carousel').each(function () {
            let that = $(this);
            carousel.render({
                elem: this
                ,width: '100%'
                ,arrow: 'none'
                ,interval: that.data('interval')
                ,autoplay: that.data('autoplay') === true
                ,trigger: (device.ios || device.android) ? 'click' : 'hover'
                ,anim: that.data('anim')
            });
        });
        element.render("progress");
    });

    // 快捷事件
    $(document).on("click", ".quick-event li a", function () {
        let url = $(this).attr("lay-href");
        $(".tpl-body iframe", parent.document).attr("src", url);
    });

    //数据概览
    layui.config({ base: "__STATIC__/js/echarts/" }).use(["carousel", "echarts"], function () {
        let $ = layui.$
            , carousel = layui.carousel
            , echarts = layui.echarts;

        wait.ajax({
            url: "{:url('Index/chart')}",
            type: "GET",
            data: {}
        }).then((res) => {
            let data = res.data;
            let echartsApp = [], options = [
                //今日流量趋势
                {
                    title: {
                        text: '今日流量趋势',
                        x: 'center',
                        textStyle: {
                            fontSize: 14
                        }
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['', '']
                    },
                    xAxis: [{
                        type: 'category',
                        boundaryGap: false,
                        data: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:30', '16:00', '18:00', '20:00', '22:00', '24:00']
                    }],
                    yAxis: [{
                        type: 'value'
                    }],
                    series: [{
                        name: '今日',
                        type: 'line',
                        smooth: true,
                        itemStyle: { normal: { areaStyle: { type: 'default' } } },
                        data: data.visit['today']
                    }, {
                        name: '昨日',
                        type: 'line',
                        smooth: true,
                        itemStyle: { normal: { areaStyle: { type: 'default' } } },
                        data: data.visit['yesterday']
                    }]
                },

                //访客浏览器分布
                {
                    title: {
                        text: '访客浏览器分布',
                        x: 'center',
                        textStyle: {
                            fontSize: 14
                        }
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: 'vertical',
                        x: 'left',
                        data: ['小程序', '公众号', 'H5', 'APP']
                    },
                    series: [{
                        name: '访问来源',
                        type: 'pie',
                        radius: '55%',
                        center: ['50%', '50%'],
                        data: [
                            { value: data.ratio['mnp'], name: '小程序' },
                            { value: data.ratio['oa'], name: '公众号' },
                            { value: data.ratio['h5'], name: 'H5' },
                            { value: data.ratio['app'], name: 'APP' }
                        ]
                    }]
                },

                //新增的用户量
                {
                    title: {
                        text: '最近7天新增的用户量',
                        x: 'center',
                        textStyle: {
                            fontSize: 14
                        }
                    },
                    tooltip: { //提示框
                        trigger: 'axis',
                        formatter: "{b}<br>新增用户：{c}"
                    },
                    xAxis: [{ //X轴
                        type: 'category',
                        data: data.user.date
                    }],
                    yAxis: [{  //Y轴
                        type: 'value'
                    }],
                    series: [{ //内容
                        type: 'line',
                        data: data.user.val,
                    }]
                }
                ]
                ,elemDataView = $('#echarts').children('div')
                ,renderDataView = function (index) {
                echartsApp[index] = echarts.init(elemDataView[index], layui.echartsTheme);
                echartsApp[index].setOption(options[index]);
                window.onresize = echartsApp[index].resize;
            };
            //没找到DOM，终止执行
            if (!elemDataView[0]) return;
            renderDataView(0);

            //监听数据概览轮播
            let carouselIndex = 0;
            carousel.on('change(echarts)', function (obj) {
                renderDataView(carouselIndex = obj.index);
            });

        });

    });
</script>
{/block}