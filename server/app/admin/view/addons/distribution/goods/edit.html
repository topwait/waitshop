{extend name="public/layout" /}

{block name="body"}
<form class="layui-form">
    <!-- 主体内容 -->
    <div class="wait-body-content">
        <!-- 商品信息 -->
        <div class="layui-form-item">
            <label class="layui-form-label" style="line-height: 52px;"><span class="asterisk">*</span>商品信息：</label>
            <div class="layui-input-block" lay-verType="tips">
                <img src="{$detail.base.image}" alt="商品主图" style="width:70px;height:70px;float:left;">
                <div class="layui-input-inline" style="margin-left:10px;">
                    <p class="wait-lh-22">{$detail.base.name}</p>
                    <input type="hidden" name="goods_id" value="{$detail.base.id}">
                </div>
            </div>
        </div>

        <!-- 选择规格 -->
        <div class="layui-form-item">
            <label class="layui-form-label"><span class="asterisk">*</span>选择规格：</label>
            <div class="layui-input-block">
                <table id="sku-lists-table" class="layui-table" lay-size="sm">
                    <thead>
                    <tr style="background-color: #F3F5F9">
                        <th width="20"><input type="checkbox" name="check" lay-skin="primary" lay-filter="all"></th>
                        {volist name="detail.spec" id="vo"}
                        <th style="white-space: nowrap;">{$vo.name}</th>
                        {/volist}
                        <th width="50"><span class="asterisk">*</span>一级佣金(%)</th>
                        <th width="50"><span class="asterisk">*</span>二级佣金(%)</th>
                        <th>市场价</th>
                        <th>售卖价</th>
                        <th>成本价</th>
                        <th>总库存</th>
                        <th>条码</th>
                    </tr>
                    </thead>
                    <tbody>
                    {volist name="detail.sku" id="vo" key="index"}
                    <tr {if $vo.dis_sku_id!=0}class="on"{/if}>
                        <td>
                            <input type="checkbox" name="sku" lay-skin="primary" lay-filter="one" {if $vo.dis_sku_id!=0}checked{/if}>
                            <input type="hidden" name="sku_id" value="{$vo.id}">
                            <input type="hidden" name="dis_sku_id" value="{$vo.dis_sku_id}">
                        </td>
                        {foreach :explode(',', $vo.spec_value_str) as $item}
                        <td>{$item}</td>
                        {/foreach}
                        <td>
                            <input type="number" name="first_ratio" class="layui-input" autocomplete="off"
                                   lay-vertype="tips" style="width:90px;" value="{$vo.first_ratio}"
                                   min="0" max="100"
                                   onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')">
                        </td>
                        <td>
                            <input type="number" name="second_ratio" class="layui-input" autocomplete="off"
                                   lay-vertype="tips" style="width:90px;" value="{$vo.second_ratio}"
                                   min="0" max="100"
                                   onkeyup="value=value.replace(/^\D*(\d*(?:\.\d{0,2})?).*$/g, '$1')">
                        </td>
                        <td>{$vo.market_price}</td>
                        <td>{$vo.sell_price}</td>
                        <td>{$vo.cost_price}</td>
                        <td>{$vo.stock}</td>
                        <td>{$vo.bar_code}</td>
                    </tr>
                    {/volist}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- 提交按钮 -->
    <div class="wait-body-footer">
        <a class="layui-layer-btn0" lay-submit lay-filter="addForm">确定</a>
        <a class="layui-layer-btn1" id="closePopupWindow">取消</a>
    </div>
</form>
{/block}


{block name="js"}
<script>
    layui.use(["form"], function () {
        let form = layui.form;

        // 全选或反选
        form.on('checkbox(all)', function (data) {
            if (data.elem.checked) {
                $("input[name='sku']").prop("checked", true);
                $("tbody td input[name='sku']").parents("tr").addClass("on")
                form.render("checkbox");
            } else {
                $("input[name='sku']").prop("checked", false);
                $("tbody td input[name='sku']").parents("tr").removeClass("on")
                form.render("checkbox");
            }
        });

        // 单选
        form.on('checkbox(one)', function (data) {
            if (data.elem.checked) {
                $(this).prop("checked", true);
                $(this).parents("tr").addClass("on")
                form.render("checkbox");
            } else {
                $(this).prop("checked", false);
                $(this).parents("tr").removeClass("on")
                form.render("checkbox");
            }
        });
    });
</script>
{/block}