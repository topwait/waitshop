(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-order-purchase-purchase"],{"17b2":function(t,e,i){"use strict";i.r(e);var a=i("a7f3"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},"5c409":function(t,e,i){var a=i("da98");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("5ffe6949",a,!0,{sourceMap:!1,shadowMode:!1})},"6f1b":function(t,e,i){"use strict";i.r(e);var a=i("96f2"),n=i("17b2");for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("c78c");var s,r=i("f0c5"),d=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"f2b0871c",null,!1,a["a"],s);e["default"]=d.exports},"96f2":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var a={waitLoading:i("5198").default,uIcon:i("e4d2").default,uFormItem:i("eb61").default,uInput:i("1fb0").default,uImage:i("c146").default,waitPopupCoupon:i("054e").default},n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"container"},[t.isFirstLoading?i("wait-loading"):t._e(),i("v-uni-view",{staticClass:"index-collect-widget"},[t.deliveryMethod.length>=2?i("v-uni-view",{staticClass:"collect-header"},[t.deliveryMethod.includes(1)?i("v-uni-view",{staticClass:"method-item u-radius-tl-12",class:1===t.deliveryType?"on":"",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onSwitchDeliveryType(1)}}},[t._v("快递配送")]):t._e(),t.deliveryMethod.includes(2)?i("v-uni-view",{staticClass:"method-item u-radius-tr-12",class:2===t.deliveryType?"on":"",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onSwitchDeliveryType(2)}}},[t._v("门店自提")]):t._e()],1):t._e(),1===t.deliveryType?i("v-uni-view",{staticClass:"u-padding-26",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onChoiceAddress.apply(void 0,arguments)}}},[t.addressId?[i("v-uni-view",{staticClass:"u-font-36 u-font-weight u-margin-bottom-20"},[t._v(t._s(t.addressData.region)+" "+t._s(t.addressData.address))]),i("v-uni-view",{staticClass:"u-font-32 u-color-muted"},[i("v-uni-text",{staticClass:"u-margin-right-14"},[t._v(t._s(t.addressData.nickname))]),i("v-uni-text",{staticClass:"u-margin-right-14"},[t._v(t._s(t.addressData.mobile))])],1)]:[i("v-uni-view",{staticClass:"u-flex u-row-between u-padding-tb-20 u-font-28"},[i("v-uni-view",{staticClass:"u-flex"},[i("u-icon",{attrs:{name:"map",size:"48",color:"#333"}}),i("v-uni-view",{staticClass:"u-margin-left-20"},[t._v("请选择收货地址")])],1),i("u-icon",{attrs:{name:"arrow-right",size:"28",color:"#333"}})],1)]],2):t._e(),2===t.deliveryType?i("v-uni-view",{staticClass:"u-padding-top-26 u-padding-lr-26 u-font-26",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onChoiceShop.apply(void 0,arguments)}}},[t.storeId&&t.storeData.name?[i("v-uni-view",{staticClass:"u-font-36 u-font-weight u-margin-bottom-10"},[t._v(t._s(t.storeData.name))]),i("v-uni-view",{staticClass:"u-font-28 u-color-muted u-margin-bottom-20"},[t._v(t._s(t.storeData.region)+t._s(t.storeData.address))]),i("v-uni-view",{staticClass:"u-font-28 u-color-main u-padding-bottom-30 u-border-bottom"},[i("u-icon",{attrs:{name:"map",size:"30",color:"#FF5058"}}),i("v-uni-text",{staticClass:"u-margin-left-10"},[t._v("距离您 "+t._s(t.storeData.distance))]),i("v-uni-text",{staticClass:"line"}),i("v-uni-text",{staticStyle:{color:"#333333"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onGoShop.apply(void 0,arguments)}}},[t._v("查看地图")])],1),i("v-uni-view",{staticClass:"form"},[i("u-form-item",{attrs:{label:"提货人","label-width":"110","border-bottom":!1}},[i("u-input",{attrs:{placeholder:"请输入姓名"},model:{value:t.contact,callback:function(e){t.contact=e},expression:"contact"}})],1),i("u-form-item",{attrs:{label:"手机号","label-width":"110","border-bottom":!1}},[i("u-input",{attrs:{placeholder:"请输入手机号"},model:{value:t.mobile,callback:function(e){t.mobile=e},expression:"mobile"}})],1)],1)]:[i("v-uni-view",{staticClass:"u-flex u-row-between u-padding-top-20 u-padding-bottom-46 u-font-28"},[i("v-uni-view",{staticClass:"u-flex"},[i("u-icon",{attrs:{name:"map",size:"48",color:"#333"}}),i("v-uni-view",{staticClass:"u-margin-left-20"},[t._v("请选择自提门店")])],1),i("u-icon",{attrs:{name:"arrow-right",size:"28",color:"#333"}})],1)]],2):t._e()],1),i("v-uni-view",{staticClass:"index-product-widget"},t._l(t.orderData.pStatusArray,(function(e,a){return i("v-uni-view",{key:a,staticClass:"product-item"},[i("u-image",{staticStyle:{"flex-shrink":"0"},attrs:{width:"160rpx",height:"160rpx","lazy-load":!0,"border-radius":"12",src:e.image}}),i("v-uni-view",{staticClass:"u-flex u-row-between u-col-top u-flex-col u-padding-left-24"},[i("v-uni-view",{staticClass:"u-line-2 u-font-28"},[t._v(t._s(e.name))]),i("v-uni-view",{staticClass:"u-font-24 u-color-muted"},[t._v(t._s(e.spec_value_str))]),i("v-uni-view",{staticClass:"u-flex u-row-between",staticStyle:{width:"100%"}},[i("v-uni-view",{staticClass:"u-font-weight u-color-major"},[i("v-uni-text",{staticClass:"u-font-22"},[t._v("￥")]),t._v(t._s(e.sellPrice))],1),i("v-uni-view",[i("v-uni-text",{staticClass:"u-font-22"},[t._v("x")]),t._v(t._s(e.count))],1)],1)],1)],1)})),1),i("v-uni-view",{staticClass:"index-remarks-widget"},[i("v-uni-view",{staticClass:"u-font-weight"},[t._v("订单备注")]),i("v-uni-view",{staticClass:"u-flex-1 u-margin-left-30"},[i("u-input",{attrs:{"input-align":"right",placeholder:"请输入留言内容"},model:{value:t.buyerRemarks,callback:function(e){t.buyerRemarks=e},expression:"buyerRemarks"}})],1)],1),i("v-uni-view",{staticClass:"index-settlement-widget"},[i("v-uni-view",{staticClass:"settlement-item"},[i("v-uni-view",{staticClass:"u-font-weight"},[t._v("商品金额")]),i("v-uni-view",{staticClass:"settlement-item__right",staticStyle:{"text-align":"right"}},[i("v-uni-view",{staticClass:"product-total-price"},[t.orderData.totalAmount>t.orderData.orderAmount?i("v-uni-text",{staticClass:"u-margin-right-10 u-font-24 u-line-through u-color-muted"},[t._v("￥"+t._s(t.orderData.totalAmount))]):t._e(),i("v-uni-text",{staticClass:"u-font-28",staticStyle:{"font-weight":"bold"}},[t._v("￥"+t._s(t.orderData.orderAmount))])],1),i("v-uni-view",{staticClass:"u-font-22 u-color-muted u-margin-top-10"},[t.isUseIntegral?i("v-uni-text",[t._v("已使用积分抵扣 ￥"+t._s(t.orderData.integralAmount))]):t._e()],1)],1)],1),i("v-uni-view",{staticClass:"settlement-item"},[i("v-uni-view",[t._v("配送费")]),i("v-uni-view",{staticClass:"u-font-28 u-font-weight"},[t._v("+￥"+t._s(t.orderData.freightAmount))])],1),i("v-uni-view",{staticClass:"settlement-item"},[i("v-uni-view",[t._v("优惠券")]),i("v-uni-view",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onShowCoupon.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"u-font-26 u-font-weight u-color-lighter u-margin-right-10"},[t.usableCoupon.length<=0?i("v-uni-text",[t._v("暂无优惠券可用")]):i("v-uni-text",{staticClass:"u-color-major"},[0==t.couponListId?i("v-uni-text",[t._v(t._s(t.usableCoupon.length)+"张可用")]):i("v-uni-text",[t._v("-￥"+t._s(t.orderData.discountAmount))])],1)],1),i("u-icon",{attrs:{name:"arrow-right",size:"24",color:"#666666"}})],1)],1),t.orderData.lenght>0&&t.orderData.integralArray.isUsable?i("v-uni-view",{staticClass:"settlement-item"},[i("v-uni-view",[i("v-uni-text",[t._v("积分抵扣")]),i("v-uni-text",{staticClass:"u-font-28 u-color-muted u-margin-left-20"},[t._v("可用"+t._s(t.orderData.integralArray.useIntegral)+"积分抵用"+t._s(t.orderData.integralArray.discountAmount)+"元")])],1),i("v-uni-checkbox",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onUseIntegral.apply(void 0,arguments)}}})],1):t._e()],1),i("v-uni-view",{staticClass:"index-payment-widget"},[i("v-uni-view",{staticClass:"payment-header"},[t._v("支付方式")]),t._l(t.payWayList,(function(e,a){return i("v-uni-view",{key:a,staticClass:"payment-item",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.onSwitchPayWay(e.id)}}},[i("v-uni-view",{staticClass:"u-flex"},[i("u-image",{attrs:{width:"48rpx",height:"48rpx",src:e.icon}}),i("v-uni-view",{staticClass:"u-margin-left-20"},[i("v-uni-view",{staticClass:"u-font-28 u-color-black"},[t._v(t._s(e.name))]),i("v-uni-view",{staticClass:"u-font-22 u-color-muted u-margin-top-10"},[t._v(t._s(e.tips))])],1)],1),t.payWayType===e.id?i("u-icon",{attrs:{name:"checkbox-mark",size:"32",color:"#FF5058"}}):t._e()],1)}))],2),i("v-uni-view",{staticStyle:{height:"120rpx"}}),i("v-uni-view",{staticClass:"index-post-widget"},[i("v-uni-view",[i("v-uni-text",{staticClass:"u-font-30 u-color-normal"},[t._v("合计应付款：")]),i("v-uni-text",{staticClass:"u-font-38 u-color-major"},[i("v-uni-text",{staticClass:"u-font-24"},[t._v("￥")]),i("v-uni-text",[t._v(t._s(t.orderData.orderAmount))])],1)],1),i("v-uni-button",{staticClass:"post-order-btn",class:t.isHandler?"loading":"",attrs:{loading:t.isHandler},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.$u.debounce(t.onSubmitOrder,500)}}},[t._v(t._s(t.orderId?"继续支付":"提交订单"))])],1),i("wait-popup-coupon",{attrs:{show:t.showCoupon,couponListId:t.couponListId,usable:t.usableCoupon,unusable:t.unusableCoupon},on:{close:function(e){arguments[0]=e=t.$handleEvent(e),t.onCloseCoupon.apply(void 0,arguments)},change:function(e){arguments[0]=e=t.$handleEvent(e),t.onConfirmCoupon.apply(void 0,arguments)}}})],1)},o=[]},a7f3:function(t,e,i){"use strict";(function(t){i("4160"),i("caad"),i("d3b7"),i("2532"),i("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i("aa57"),n=i("ada8"),o={data:function(){return{isFirstLoading:!0,orderId:0,from:"order",deliveryType:1,addressId:0,addressData:{},storeId:0,storeData:[],contact:"",mobile:"",isHandler:!1,payWayType:2,payWayList:[],products:[],orderData:[],buyerRemarks:"",couponListId:-1,isUseIntegral:0,showCoupon:!1,usableCoupon:[],unusableCoupon:[],deliveryMethod:[1],longitude:0,latitude:0,seckillId:0}},onLoad:function(t){var e=this,i=JSON.parse(decodeURIComponent(t.data));this.from=i.from||"order",this.products=i.products,this.seckillId=t.seckill_id||0,this.getOrderSettle(),this.getPayment(),uni.$on("selectAddress",(function(t){e.addressId=t.id,e.getOrderSettle()})),uni.$on("selectStore",(function(t){e.storeId=t.id,e.getOrderSettle()}))},onUnload:function(){uni.$off("selectAddress"),uni.$off("selectStore")},methods:{getOrderSettle:function(){var t=this,e={address_id:this.addressId,store_id:this.storeId,coupon_list_id:this.couponListId,is_use_integral:this.isUseIntegral,products:this.products,longitude:this.longitude,latitude:this.latitude,seckill_id:this.seckillId};this.$u.api.apiOrderSettle(e).then((function(e){if(0!==e.code)return t.$showToast("loading order error");e.data.address&&(t.addressData=e.data.address,t.addressId=e.data.address.id),e.data.store&&(t.storeData=e.data.store,t.storeId=e.data.store.id),t.deliveryMethod=e.data.deliveryMethod,t.deliveryMethod.includes(1)||(t.deliveryType=2),t.couponListId=e.data.couponListId,t.usableCoupon=e.data.coupon.usable||[],t.unusableCoupon=e.data.coupon.unusable||[],t.isUseIntegral=e.data.isUseIntegral||0,t.orderData={pass:e.data.pass,status:e.data.status,discountAmount:e.data.discountAmount,freightAmount:e.data.freightAmount,integralAmount:e.data.integralAmount,orderAmount:e.data.orderAmount,totalAmount:e.data.totalAmount,totalCount:e.data.totalCount,useIntegral:e.data.useIntegral,integralArray:e.data.integralArray,pStatusArray:e.data.pStatusArray},t.$nextTick((function(){t.isFirstLoading=!1}))}))},getPayment:function(){var t=this;this.$u.api.apiPaymentWay().then((function(e){t.payWayList=e.data}))},onChoiceAddress:function(){uni.navigateTo({url:"/pages/address/list/list?type=1"})},onChoiceShop:function(){var t=this;uni.getLocation({type:"wgs84",success:function(e){t.longitude=e.longitude,t.latitude=e.latitude,uni.navigateTo({url:"/bundle/pages/store_list/store_list?type=1&longitude="+e.longitude+"&latitude="+e.latitude})}})},onGoShop:function(){var t=this;uni.getLocation({type:"wgs84",success:function(e){var i=e.longitude,a=e.latitude,n="id="+t.storeId+"&lng="+i+"&lat="+a;uni.navigateTo({url:"/bundle/pages/store_detail/store_detail?"+n})}})},onSwitchDeliveryType:function(t){this.deliveryType=t},onSwitchPayWay:function(t){this.payWayType=t},onUseIntegral:function(){this.isUseIntegral=!this.isUseIntegral,this.getOrderSettle()},onShowCoupon:function(){this.showCoupon=!0},onCloseCoupon:function(){this.showCoupon=!1},onConfirmCoupon:function(t){this.couponListId=t,this.showCoupon=!1,this.getOrderSettle()},getSubscribeMessage:function(){var t=this;return new Promise((function(e,i){t.$u.api.apiSubscribe().then((function(t){if(0!==t.code)throw new Error(msg);if(!t.data.length)return i();uni.requestSubscribeMessage({tmplIds:t.data,success:function(t){e(t)},fail:function(t){i(t)}})})).catch((function(t){i(t)}))}))},onSubmitOrder:function(){var e=this;if(2===this.deliveryType){if(""==this.contact)return this.$showToast("自提人姓名不能为空");if(""==this.mobile)return this.$showToast("自提人联系电话不能为空")}if(1===this.deliveryType&&!this.addressId)return this.$showToast("请选择收货地址");var i=[];this.orderData.pStatusArray.forEach((function(t){i.push({goods_id:t.id,sku_id:t.sku_id,num:t.count})}));var a={client:(0,n.isClient)(),products:i,pay_way:this.payWayType,delivery_type:this.deliveryType,address_id:this.addressId,store_id:this.storeId,contact:this.contact,mobile:this.mobile,coupon_list_id:this.couponListId,is_use_integral:this.isUseIntegral,remarks:this.buyerRemarks,seckill_id:this.seckillId};this.isHandler||uni.showModal({title:"温馨提示",content:"是否确认下单?",confirmColor:"#FF2C3C",success:function(i){var n=i.confirm;n&&(e.isHandler=!0,e.getSubscribeMessage().catch((function(e){t("log",e," at pages/order/purchase/purchase.vue:495")})).finally((function(){e.handleOrderSubmit(a)})))}})},handleOrderSubmit:function(t){var e=this,i=this;uni.showLoading({title:"发起支付中",mask:!0}),setTimeout((function(){i.orderId&&0!==i.orderId?(uni.hideLoading(),i.handleOrderPayment()):i.$u.api.apiOrderBuy(t).then((function(t){if(0!==t.code)return e.isHandler=!1,i.$showToast(t.msg);i.orderId=t.data.order_id,i.handleOrderPayment()})).finally((function(){uni.hideLoading()}))}),1e3)},handleOrderPayment:function(){var t=this;this.$u.api.apiPaymentPay({from:this.from,client:(0,n.isClient)(),order_id:this.orderId,pay_way:this.payWayType}).then((function(e){var i=e.code,n=e.msg,o=e.data;switch(i){case 1:t.$showToast(n);break;case 2100:uni.redirectTo({url:"/pages/order/pay_results/pay_results?id="+t.orderId});break;case 2200:(0,a.wxpay)(o).then((function(e){uni.redirectTo({url:"/pages/order/pay_results/pay_results?id="+t.orderId})}));break;case 2300:alipay(o).then((function(e){uni.redirectTo({url:"/pages/order/pay_results/pay_results?id="+t.orderId})}));break}t.isHandler=!1}))}}};e.default=o}).call(this,i("0de9")["log"])},c78c:function(t,e,i){"use strict";var a=i("5c409"),n=i.n(a);n.a},da98:function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/* 颜色 */\r\n/* 边框 */\r\n/* 引入Uview */.index-collect-widget[data-v-f2b0871c]{margin:%?20?%;border-radius:%?12?%;background-color:#fff}.index-collect-widget .collect-header[data-v-f2b0871c]{display:flex;justify-content:space-between;height:%?88?%}.index-collect-widget .collect-header .method-item[data-v-f2b0871c]{position:relative;display:flex;align-items:center;justify-content:center;width:50%;background-color:#f8fcfd}.index-collect-widget .collect-header .on[data-v-f2b0871c]{font-size:%?32?%;font-weight:700;color:#ff5058;background-color:#fff}.index-collect-widget .collect-header .on[data-v-f2b0871c]::after{content:"";position:absolute;z-index:900;bottom:%?8?%;left:%?115?%;width:%?140?%;height:%?16?%;background-image:linear-gradient(90deg,#fbb6b9,#fdd1d3,#fcd8da,#fff)}.index-collect-widget .line[data-v-f2b0871c]{display:inline-block;width:1px;height:%?28?%;margin:0 %?16?%;vertical-align:middle;background-color:#eee}.index-product-widget[data-v-f2b0871c]{margin:%?20?%;padding:%?10?% %?20?%;border-radius:%?12?%;background-color:#fff}.index-product-widget .product-item[data-v-f2b0871c]{display:flex;padding:%?10?% 0}.index-remarks-widget[data-v-f2b0871c]{display:flex;align-items:center;justify-content:space-between;margin:%?20?%;padding:%?10?% %?20?%;border-radius:%?12?%;background-color:#fff}.index-settlement-widget[data-v-f2b0871c]{margin:%?20?%;padding:%?20?%;border-radius:%?12?%;background-color:#fff}.index-settlement-widget .settlement-item[data-v-f2b0871c]{display:flex;justify-content:space-between;padding:%?20?% 0}.index-settlement-widget .settlement-item .vip-icon[data-v-f2b0871c]{width:%?26?%;height:%?26?%;vertical-align:top;margin-top:%?4?%;margin-right:%?8?%}.index-settlement-widget .settlement-item .settlement-item__right .product-discount-price[data-v-f2b0871c]{font-size:%?24?%;color:#999;margin-top:%?10?%}.index-payment-widget[data-v-f2b0871c]{margin:%?20?%;border-radius:%?12?%;background-color:#fff}.index-payment-widget .payment-header[data-v-f2b0871c]{font-size:%?28?%;font-weight:700;padding:%?20?%;color:#666}.index-payment-widget .payment-item[data-v-f2b0871c]{display:flex;align-items:center;justify-content:space-between;padding:12px 0;margin:0 %?20?%;border-bottom:1px solid hsla(0,0%,94.9%,.6)}.index-payment-widget .payment-item[data-v-f2b0871c]:first-child{padding-top:%?10?%}.index-payment-widget .payment-item[data-v-f2b0871c]:last-child{border-bottom:none}.index-post-widget[data-v-f2b0871c]{position:fixed;bottom:0;left:0;right:0;z-index:100;display:flex;align-items:center;justify-content:flex-end;height:%?100?%;padding:0 %?20?%;box-shadow:0 0 %?8?% #eee;background-color:#fff}.index-post-widget .total-product-price[data-v-f2b0871c]{font-size:%?30?%;font-weight:700;color:#333}.index-post-widget .post-order-btn[data-v-f2b0871c]{margin-left:30px;width:100px;height:%?76?%;line-height:%?76?%;font-size:%?26?%;font-weight:700;color:#fff;text-align:center;border-radius:20px;background-image:linear-gradient(90deg,#f95f2f,#ff2c3c)}.index-post-widget .post-order-btn.loading[data-v-f2b0871c]{color:#f7eaea!important;background-image:linear-gradient(90deg,#fd9371,#f56772)!important}',""]),t.exports=e}}]);